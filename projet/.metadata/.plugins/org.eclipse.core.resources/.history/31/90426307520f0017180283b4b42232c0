package Window;

import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.Rectangle;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import javax.swing.Timer;

import javax.imageio.ImageIO;
import javax.swing.JPanel;

import MainSystem.Modele;

public class PanelAnimation2 extends JPanel implements ActionListener, MouseListener {

	private PanelAnimation2 pane;
	private Modele modele;
	private PanelLeft left;
	private PanelRight right;
	private ScorePanel score;
	
	//ArrayList content
	private int numberOfNenuphars;
	private ArrayList<Integer> startFrameNenu;
	private ArrayList<Nenuphar2> nenuphars;
	private int nenuTimeToLive;
	
	//nenuphar selector
	private int hupperThreshold;
	private int lowerThreshold;

	//image
	private static final Image IMG_NENUPHAR = ImageLoader.loadImage("Graphics" + File.separator + "vertb.jpg");
	
	//Timer
	private int fps;
	private int frame;
	private Timer tempo;
	
	public PanelAnimation2(Modele mainmodele, PanelLeft left, PanelRight right, ScorePanel score) {

		this.pane = this;
		this.left = left;
		this.right = right;
		this.score = score;
		this.modele = mainmodele;
		this.numberOfNenuphars = this.modele.getAllTheAskedWordsVocabGameGraphic().size();
		this.frame = 1 ;
		
		this.fps = 1;
		this.tempo = new Timer(1000/this.fps,this);
		
		this.nenuTimeToLive = 150;
		initializeNenuphars();
		
		addMouseListener(this);
	}

	public void nextFrame() {
		this.frame++;
		if (this.hupperThreshold < this.numberOfNenuphars) {
			if (this.frame == this.startFrameNenu.get(this.hupperThreshold)) {
				this.hupperThreshold++;
			}
		}	
		this.repaint();
	}
	

	public void paintComponent(Graphics g) {
		super.paintComponent(g);
		Graphics2D graphic2D = (Graphics2D) g;
		try {
			Image img = ImageIO.read(new File("Graphics" + File.separator + "water.jpg"));
			g.drawImage(img, 0, 0, this.getWidth(), this.getHeight(), this);
		} catch (IOException e) {
			e.printStackTrace();
		}
		
		drawNenuphars(graphic2D);
		
		if (!this.tempo.isRunning()) {
			graphic2D.setFont(new Font(Font.SANS_SERIF, Font.BOLD, 32));
			graphic2D.setColor(Color.WHITE);
			graphic2D.drawString("Click here !", (Main.window.getWidth()-400)/2-100, (Main.window.getHeight()-50)/2-50);
		}
	}

	public void initializeNenuphars() {
		this.hupperThreshold = 0;
		this.lowerThreshold = 0;
		this.nenuphars = new ArrayList<Nenuphar2>();
		this.startFrameNenu = new ArrayList<Integer>();
		for (int i=0; i < this.numberOfNenuphars ;i++) {
			this.nenuphars.add(new Nenuphar2(
					this.modele, 
					this.modele.getAllTheAskedWordsVocabGameGraphic().get(i),
					(Main.window.getWidth()-2*200)/2,
					50, 
					this.nenuTimeToLive)) ;
			this.startFrameNenu.add(10*i +30);
		}
		
	}
	
	public void drawNenuphars(Graphics2D g) {
		for (int i=this.lowerThreshold ; i < this.hupperThreshold ; i++) {
			System.out.println(this.nenuphars.get(i).getTimeLived()+1);
			if (this.nenuphars.get(i).getTimeLived()+1 != this.nenuTimeToLive) {
				//System.out.println(i + " : Position x : " + this.nenuphars.get(i).getPosX() + " position y : " + this.nenuphars.get(i).getPosY());
				g.drawImage(this.IMG_NENUPHAR, this.nenuphars.get(i).getPosX(), this.nenuphars.get(i).getPosY(), null);
				g.drawString(this.nenuphars.get(i).getLabel(), this.nenuphars.get(i).getPosX(), this.nenuphars.get(i).getPosY());
				
				this.nenuphars.get(i).increaseTimeLived();
				//System.out.println(this.nenuphars.get(i).getTimeLived() );
				this.nenuphars.get(i).setPosX(   (int) ((Main.window.getWidth()-2*200)/2 + (150* this.nenuphars.get(i).getStaticTrajectoryX(this.nenuphars.get(i).getTimeLived())) ) );
				this.nenuphars.get(i).setPosY(this.nenuphars.get(i).getPosY()+10);
			}
			else {
				this.lowerThreshold++;
				System.out.println(this.lowerThreshold);
			}
		}
	}
	
	@Override
	public void mouseClicked(MouseEvent e) {
		System.out.println("Click");
		Handler(e);
		if (! this.tempo.isRunning()) {
			System.out.println("Start tempo");
			this.tempo.start();
		}
		
	}
	
	public void Handler(MouseEvent e) {
		for (int i = this.lowerThreshold ; i < this.hupperThreshold ; i++) {
			if ( (e.getX() - this.nenuphars.get(i).getPosX() < 50) && (e.getY() - this.nenuphars.get(i).getPosY() < 50)) {
				int p = this.modele.getAllTheAskedWordsVocabGameGraphic().indexOf(this.nenuphars.get(i).getLabel());
				left.setProp(p);
				right.setProp(p);
				left.validate();
				right.validate();
			}
		}
	}

	@Override
	public void mousePressed(MouseEvent e) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void mouseReleased(MouseEvent e) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void mouseEntered(MouseEvent e) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void mouseExited(MouseEvent e) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void actionPerformed(ActionEvent e) {
		if (e.getSource() == this.tempo) {
			//System.out.println("Next frame");
			this.nextFrame();
		}
		
	}
	
	public static class ImageLoader {

		public static Image loadImage (String filename) {
			Image image = null;
			try {
				image = ImageIO.read(new File(filename)); 
			}
			catch (IOException e) {
				e.printStackTrace();
			}
			return image; 
		}
	}

}

